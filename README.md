# md2testspec

Markdown形式の仕様書からテスト仕様書を生成するツール。

## フォルダ構成

テストツールのトップレベルスクリプトファイル（md2testspec.bat/sh）は、第1階層におき、それらが利用するコンテンツ群はそれぞれのフォルダ以下に配置する。  

```bash

md2testspec
|-- test_util
|   |-- [テストツールコンテンツ群]
...
|-- md2testspec.bat (Windows向けテストスクリプト)
|-- md2testspec.sh (Linux/macOS向けテストスクリプト)
|-- README.md (本ファイル)
```

## 必要なソフトウェア

本ツールを作動するため、利用するOS上に次のソフトウェアを別途インストールする。

- Perl
  - オープンソースのスクリプト言語で、マルチプラットフォームに対応しており、WindowsやmacOS、Linuxと様々な環境で動かすことができる。

## テストツールの仕様

### テストツールのスクリプトファイル

| スクリプト | 説明 |
| ----- | ----- |
| md2testspec | Markdown形式の仕様書ファイルからテスト項目となる箇所を抽出して、テスト仕様書を生成する。<br>Windows向けのバッチファイルとLinux/macOS向けのシェルファイルを提供する。 |

### 環境変数

このツールは起動時に環境変数を参照する。利用するOSにしたがって設定する。

|  環境変数名 |  説明  |
| ---- | ---- |
|  MD2DOC_LANG  | 日本語版(jp)あるいは英語版(en)で生成するか。設定がなければjpが利用される。 |

### 起動方法

#### Windowsの場合

```bash
> md2testspec.bat <仕様書ファイル名>.md
```

#### Linux/macOSの場合

```bash
> ./md2testspec.sh <仕様書ファイル名>.md
```

出力は、<仕様書ファイル名>_testspec.md という名前で出力される。
このツールはテスト関連のトップレベルのスクリプトであり、その内部では別のPerlプログラムファイル **detect_test_items.pl** を呼び出す。

### detect_test_itemsの仕様

Markdownファイルの内容から試験項目箇所を収集し、テスト仕様書の一部分としてMarkdownファイルを出力するPerlプログラムである。

```bash
> perl test_util/detect_test_items.pl [入力するMDファイル名] > [出力するMDファイル名] [言語（en or jp）]
```

試験項目の抽出を開始する箇所（見出し）には、Markdownの拡張記法{.testitems}を付与する。

```markdown
### 見出し {.testitems}
```

試験項目取得の終了は、次の見出しまでとする。取得する内容に表が含まれている場合、仕様定義とみなし、**項目番号**、**テスト結果**、そして**メモ**の列を自動的に追加する。

元の表の例：

| 見出し | プレースホルダ | フォーム部品 | 補足説明 |
| ----- | ----- | ----- | ----- |
| 名称 | 物件の名前を記入 | 1行テキスト | 初期設定のまま |
| 物件タイプ | 物件のタイプを選択 | 1行テキスト | アパート、一戸建て、土地、オフィス、その他、から選択 |
| 価格 | 価格を入力 | 数値 | 3桁区切り、円を付与 |
| 住所 | 住所を入力 | テキスト | 4行程度を記入できる |

抽出後の表の例：

| # | 見出し | プレースホルダ | フォーム部品 | 補足説明 | テスト結果 | メモ |
| --- | ----- | ----- | ----- | --- | --- | --- |
| 1 | 名称 | 物件の名前を記入 | 1行テキスト | 初期設定のまま | OK, NG or Attn | - |
| 2 | 物件タイプ | 物件のタイプを選択 | 1行テキスト | アパート、一戸建て、土地、オフィス、その他、から選択 | OK, NG or Attn | - |
| 3 | 価格 | 価格を入力 | 数値 | 3桁区切り、円を付与 | OK, NG or Attn | - |
| 4 | 住所| 住所を入力 | テキスト | 4行程度を記入できる | OK, NG or Attn | - |

### ヘッダーとフッタファイルについて

テスト項目を抽出したMarkdown形式のファイルの前後にヘッダファイルとフッタファイルをマージして、テスト仕様書ファイルを作成する。それらの関連ファイルは、test_utilフォルダ以下に対象言語のフォルダごとに置かれている。

| フォルダ名 | 説明 |
| ----- | ----- |
| en | 英語版向けの関連ファイル |
| jp | 日本語向けの関連ファイル |

それぞれの対象言語フォルダには次のファイルを配置する。

| ファイル名 | 内容 |
| --- | --- |
| Head.txt | ヘッダファイル |
| Foot.txt | フッタファイル |

これらのファイルは標準的なテンプレートであり（以下の例を参照）、仕様書の内容に応じて修正する。

#### ヘッダファイルの内容

日本語版の例

```text
# 〇〇テスト仕様書

## 序論（はじめに）

### 目的

### テスト期間

### 注意事項など

## テスト環境について

### 試験対象機材とOSバージョン

### テスト用アカウント

### テストデータの準備・作成方法など

```

#### フッタファイルの内容

日本語版の例

```text
## テスト判定

### テスト結果

| 試験日 | 試験担当者 | OK | NG | Attn |
| --- | --- | --- | --- | --- |
| YYYY-MM-DD | - | - | - | - |

### 判定結果

合格/不合格

### コメント

```

## 注意事項

- Linux/macOS環境でシェルを実行するためにはファイルに実行権限を付与する。

```bash
chmod +x *.sh */*.sh
```

- Windows環境で保存したシェルファイル（.sh）はLinux/macOS上で次のコマンドで改行を変換する。

```bash
sed -i -e 's/\r$//' *.sh */*.sh
```

## 更新履歴

- 2025-03-21 - 初版（md2docから分離）
